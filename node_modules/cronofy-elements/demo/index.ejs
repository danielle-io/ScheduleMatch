<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Embedding demo</title>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.js"></script>
    <link href="/demo/demo-styles.css" rel="stylesheet">
</head>
<body class="trouble">

    <% var slug = 'home'; %>
    <%- include nav.ejs %>

    <h1>Ad ea pariatur quis pariatur enim eu qui amet est proident culpa.</h1>
    <div id="cronofy-availability-rules"></div>
    <p>Lorem ipsum, dolor sit amet consectetur adipisicing elit. Recusandae, doloribus eaque? Animi, velit culpa nostrum omnis vitae rem placeat ut mollitia autem porro! Qui molestiae porro rerum similique, aliquid deleniti!</p>
    <!-- <img src="http://placecage.com/c/960/350" alt=""> -->
    <hr>
    <div class="wrapper">
        <div class="column">
            <div id="cronofy-calendar"></div>
            <h2>Consectetur adipisicing elit</h2>
            <p>Lorem ipsum dolor sit, amet consectetur adipisicing elit. <a href="/">Voluptate sed ex totam odit</a> quae hic voluptatibus, quisquam dicta animi laborum velit laboriosam, placeat suscipit tenetur voluptates! Illo tempora minus animi.</p>
            <!-- <img src="http://placecage.com/470/500" alt=""> -->
            <p>Lorem ipsum, dolor sit amet consectetur adipisicing elit. Quidem consequuntur repudiandae nesciunt, totam dicta earum deleniti magnam eveniet eligendi sunt adipisci veniam esse aliquid aperiam corporis optio fuga tempora sit!</p>
        </div>
        <div class="column">
            <div id="cronofy-calendar-sync"></div>
            <h2>Est deserunt non quis do quis nostrud ad exercitation proident incididunt.</h2>
            <!-- <img src="http://placecage.com/c/470/600" alt=""> -->
            <p>Excepturi dicta neque ut, a expedita quaerat, tempore dolor placeat quibusdam cumque ipsam cum officia voluptate, ea fuga optio necessitatibus inventore tempora?</p>
            <!-- <div id="cronofy-calendar" style="width:100%;height:500px;"></div> -->
            <div id="cronofy-slot-picker"></div>
            <p>Lorem ipsum dolor sit, amet consectetur adipisicing elit. Natus nisi eveniet voluptas provident esse beatae minus at error dignissimos neque? Temporibus velit numquam aut labore porro neque ipsum, deleniti a?</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eum sunt eligendi, error quos nulla dolorem alias corrupti iste fugiat deleniti nam unde, porro provident a voluptatem at voluptates, dolores sed!</p>
        </div>
    </div>
    <button id="cronofy-availability-query">New Query</button>
    <div id="cronofy-availability-viewer"></div>
    <p>Lorem ipsum dolor sit, amet consectetur adipisicing elit. Natus nisi eveniet voluptas provident esse beatae minus at error dignissimos neque? Temporibus velit numquam aut labore porro neque ipsum, deleniti a?</p>
    <p>Lorem ipsum dolor sit, amet consectetur adipisicing elit. Debitis saepe maxime corporis nemo hic rerum porro in repudiandae? Libero eligendi impedit reiciendis exercitationem fuga ex eos aliquid itaque facere corrupti.</p>    
    <hr>
    <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eum sunt eligendi, error quos nulla dolorem alias corrupti iste fugiat deleniti nam unde, porro provident a voluptatem at voluptates, dolores sed!</p>
    <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Voluptatum commodi fuga laboriosam? Quas officiis doloremque iure modi, ipsam dolore ad illum saepe et voluptatum quis tempore ullam dolor, sequi nulla!</p>
    <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eum sunt eligendi, error quos nulla dolorem alias corrupti iste fugiat deleniti nam unde, porro provident a voluptatem at voluptates, dolores sed!</p>

    <script src="../build/CronofyElements.dev.js"></script>
    <!-- <script src="https://elements.cronofy.com/js/CronofyElements.v0.7.14.js"></script> -->
    <!-- <script src="https://components.cronofy.com/js/CronofyComponents.v0.4.0.js"></script> -->

    <script>
        console.log('loading elements...');
        const locale = 'fr';

        const display = {
            // 0 = don't show the element
            // 1 = show the element
            Agenda: 1,
            SlotPicker: 0,
            AvailabilityViewer: 0,
            AvailabilityRules: 1,
            CalendarSync: 1
        }

        if (display.CalendarSync) {
            CronofyElements.CalendarSync({
                element_token: "<%= single_token %>",
                target_id: 'cronofy-calendar-sync',
                app_domain:"<%= app_domain %>",
                api_domain:"<%= api_domain %>",
                data_center: "us",
                // authorization_url: "http://localhost:8080/auth/cronofy",
                // authorization_url: "/auth/cronofy",
                authorization: {
                    redirect_uri: "http://localhost:8080/",
                    client_id: "<%= client_id %>",
                    scope: "read_only"
                },
                tzid: "Etc/UTC",
                demo: false,
                callback: cb => {
                  console.log("callback", cb);
                }
            });
        }

        if (display.AvailabilityRules) {
            CronofyElements.AvailabilityRules({
                element_token: "<%= single_token %>",
                target_id: 'cronofy-availability-rules',
                api_domain:"<%= api_domain %>",
                // availability_rule_id: "testing_element_connection",
                availability_rule_id: "work_hours",
                tzid: "Etc/UTC",
                config: {
                    start_time:"08:00",
                    end_time: "18:00",
                    duration: 15
                },
                styles: {
                    prefix: "customAR",
                    // colors: {available: "red"}
                },

                // locale: locale,
                demo: true
                // callback: slot => console.log('callback',slot),
            });
        }

        if (display.Agenda) {
            CronofyElements.Agenda({
                element_token: "<%= single_token %>",
                target_id: 'cronofy-calendar',
                api_domain:"<%= api_domain %>",
                // locale: locale,
                demo: true,
                styles: {
                    colors:{ calendars: ['#0074d9','#ffdc00'] },
                    prefix:"customAG"
                }
            });
        }

        if (display.SlotPicker) {

            const slotTimes = function(days, time) {
                const timeString = `${moment().utc().format("YYYY-MM-DD")}T${time}:00Z`;
                const output = moment(timeString)
                    .add(days, "days");
                return output.utc().format();
            };

            CronofyElements.SlotPicker({
                element_token: "<%= single_token %>",
                target_id: 'cronofy-slot-picker',
                api_domain:"<%= api_domain %>",
                query: {
                    participants: [
                        {
                            required: "all",
                            members: [
                                { sub: "<%= sub %>" }
                            ]
                        }
                    ],
                    required_duration: { minutes: 30 },
                    available_periods: [
                        { start: slotTimes(1,"23:00"), end: slotTimes(2,"01:00") },
                        { start: slotTimes(2,"23:00"), end: slotTimes(3,"01:00") },
                        { start: slotTimes(3,"23:00"), end: slotTimes(4,"01:00") }
                    ]
                },
                styles: {
                    prefix: "custom-name"
                },
                callback: slot => console.log('callback',slot),
                // locale: locale,
                // demo: true
            });
        }

        if (display.AvailabilityViewer) {

            const utcOffset = moment().utcOffset();
            const invertedOffset =
                Math.sign(utcOffset) === -1 ? Math.abs(utcOffset) : 0 - utcOffset;
            const offset = invertedOffset / 60;

            const today = moment()
                .add(1, "day")
                .seconds(0);
            const startDay = today
                .startOf('isoWeek')
                .subtract(1, "day")
                .add(7,"day");

            const offsetTime = function(days, time) {
                const timeString = `${startDay.clone().format("YYYY-MM-DD")}T${time}:00Z`;
                const output = moment(timeString)
                    .add(days, "days")
                    .add(offset, "hours");
                return output.utc().format();
            };

            const Viewer = CronofyElements.AvailabilityViewer({
                element_token: "<%= single_token %>",
                target_id: 'cronofy-availability-viewer',
                api_domain:"<%= api_domain %>",
                query: {
                    participants: [
                        {
                            required: "all",
                            members: [
                                { sub: "<%= sub %>" }
                            ]
                        }
                    ],
                    required_duration: { minutes: 60 },
                    available_periods: [
                        { start: offsetTime(1, "09:00"), end: offsetTime(1, "17:30") },
                        { start: offsetTime(2, "08:00"), end: offsetTime(2, "17:30") },
                        { start: offsetTime(3, "09:00"), end: offsetTime(3, "17:30") },
                        { start: offsetTime(4, "09:00"), end: offsetTime(4, "17:30") },
                        { start: offsetTime(5, "09:00"), end: offsetTime(5, "17:30") },
                        { start: offsetTime(8, "09:00"), end: offsetTime(8, "17:30") },
                        { start: offsetTime(9, "09:00"), end: offsetTime(9, "17:30") },
                        { start: offsetTime(10, "09:00"), end: offsetTime(10, "17:30") },
                        { start: offsetTime(11, "09:00"), end: offsetTime(11, "17:30") },
                        { start: offsetTime(12, "09:00"), end: offsetTime(12, "17:30") }
                    ],
                },
                extras: {
                    start_time:"08:00",
                    end_time: "18:00",
                    interval: 30,
                    mode: "multi_select", // default | multi_select | no_confirm,
                    // max_selection_count: 3
                },
                styles: {
                    prefix: "customAV_noStyles"
                    // prefix: "customAV"
                },
                callback: slot => console.log('callback',slot),
                // locale: locale,
                // demo: true
            });

            const newQuery = document.querySelector('#cronofy-availability-query');
            newQuery.addEventListener('click',loadNewQuery,false);

            function loadNewQuery() {
                const newExtras = {
                    start_time: `0${Math.ceil(Math.random() * (9 - 7) + 7)}:${Math.ceil(Math.random() * (3 - 0) + 0)}0`,
                    end_time: `${Math.ceil(Math.random() * (18 - 15) + 15)}:${Math.ceil(Math.random() * (5 - 0) + 0)}0`,
                    interval: 15
                };

                console.log(newExtras);
                Viewer.update({
                    extras: newExtras
                });
            }
        }

        console.log('done.');
    </script>

</body>
</html>
