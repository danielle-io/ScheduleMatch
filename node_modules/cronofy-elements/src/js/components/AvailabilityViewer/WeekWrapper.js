import React, { useContext, useEffect, useState } from "react";
import { css, jsx } from "@emotion/core";

import { timeLabels } from "../../helpers/slots";

import DayLabels from "./DayLabels";
import LabelColumn from "./LabelColumn";
import MonthLabels from "./MonthLabels";
import Week from "./Week";

import {
    ThemeContext,
    LimitsContext,
    SlotsContext,
    StatusContext
} from "./AvailabilityViewer";

export const LabelsContext = React.createContext();

const WeekWrapper = () => {
    const [theme, setTheme] = useContext(ThemeContext);
    const [status, setStatus] = useContext(StatusContext);
    const slots = useContext(SlotsContext);
    const [limits, setLimits] = useContext(LimitsContext);

    const [labels, setLabels] = useState(
        timeLabels(limits, slots[1].day, status.tzid)
    );

    useEffect(() => {
        setLabels(timeLabels(limits, slots[1].day, status.tzid));
    }, [slots, limits]);
    return (
        <LabelsContext.Provider value={labels}>
            <div className={`${theme.prefix}__body`}>
                <MonthLabels />
                <DayLabels />
                <div
                    css={css`
                        display: flex;
                        justify-content: stretch;
                        position: relative;
                    `}
                    className={`${theme.prefix}__week`}
                >
                    <LabelColumn />
                    <Week />
                </div>
            </div>
        </LabelsContext.Provider>
    );
};

export default WeekWrapper;
