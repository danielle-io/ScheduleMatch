.PHONY: default
default: install dev

.PHONY: install
install:
	npm install

.PHONY: init
init: install
	npm run build_dev

.PHONY: clean
clean:
	rm -rf build/*

.PHONY: env_check
env_check:
ifeq ("$(wildcard ./src/js/env.js)","")
	echo "./src/js/env.js does not exist, see ./src/js/env.example.js for a reference"
	exit 1
endif

.PHONY: dev
dev: env_check
	npm run dev &
	npm run serve

.PHONY: dev_compat
dev_compat: env_check
	npm run dev_compat &
	npm run serve

.PHONY: build
build: install
	npm run build

.PHONY: rebuild
rebuild: clean build

.PHONY: ci
ci: clean test

.PHONY: test
test: install
	npm run test

.PHONY: publish_npm
publish_npm:
	npm config set '//registry.npmjs.org/:_authToken' "$${NPM_TOKEN:?}"
	npm run test
	npm publish

.PHONY: publish
publish: rebuild publish_npm
	aws s3 cp ./build s3://cronofy-component-assets/js/ --recursive

.PHONY: build_dev
build_dev:
	npm run build_dev

.PHONY: bump_version
bump_patch:
	npm version patch
	npm run build
	git push
	git push --tags

.PHONY: bump_minor
bump_minor:
	npm version minor
	npm run build
	git push
	git push --tags

.PHONY: bump_major
bump_major:
	npm version major
	npm run build
